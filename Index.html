<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LockGram Mini</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    :root{--accent:#00ff88;--bg:#0a0a0a;--card:#111;--text:#fff;--sub:#aaa}
    *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif}
    body{background:var(--bg);color:var(--text);display:flex;flex-direction:column;align-items:center;padding:20px;min-height:100vh}
    header{text-align:center;margin-bottom:30px}
    header img{height:60px;border-radius:50%}
    header h1{font-size:24px;color:var(--accent);margin-top:8px}
    header p{color:var(--sub);font-size:14px}
    #wallet{width:100%;max-width:320px;margin-bottom:20px}
    #connectBtn{width:100%;margin-top:10px;background:var(--accent);color:#000;border:none;padding:14px;border-radius:24px;font-weight:700;font-size:16px;cursor:pointer}
    #actions{display:flex;flex-direction:column;gap:12px;width:100%;max-width:320px}
    .btn{background:var(--accent);color:#000;border:none;padding:14px;border-radius:24px;font-weight:700;cursor:pointer;transition:.2s;font-size:16px}
    .btn:hover{transform:scale(1.03)}
    footer{margin-top:auto;text-align:center;font-size:14px;color:var(--sub);padding:20px 0}
    footer span{color:var(--accent);font-weight:700;font-size:18px}
    #addr{margin-top:8px;font-size:13px;color:var(--sub);word-break:break-all}
    #status{margin-top:15px;color:var(--accent);font-weight:600}
  </style>
</head>
<body>
  <header>
    <img src="https://i.imgur.com/LQuakpq.png" alt="LockGram"/>
    <h1>LockGram Mini</h1>
    <p>Connect TON wallet → earn LockCoins</p>
  </header>

  <section id="wallet">
    <button id="connectBtn">Connect Wallet</button>
    <p id="addr"></p>
  </section>

  <section id="actions">
    <button class="btn" onclick="invite()">Invite Friend (+10 LC)</button>
    <button class="btn" onclick="checkIn()">Daily Check-In (+5 LC)</button>
  </section>

  <footer>
    <p>Balance: <span id="balance">0</span> LockCoins</p>
    <p id="status">Tap an action to start</p>
  </footer>

  <script>
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    let userBalance = 0;
    let userWallet = null;

    // TON Connect UI – 2025 correct way
    const tonConnectUI = new TonConnectUI({
      manifestUrl: 'https://meek-creponne-1338a7.netlify.app/manifest.json',
      buttonRootId: 'connectBtn' // auto-handles the button
    });

    // Wallet status change
    tonConnectUI.onStatusChange(async (wallet) => {
      userWallet = wallet;
      const addrEl = document.getElementById('addr');
      const statusEl = document.getElementById('status');

      if (wallet) {
        const short = wallet.account.address.slice(0, 6) + '...' + wallet.account.address.slice(-4);
        addrEl.textContent = short;
        statusEl.textContent = 'Wallet connected!';

        // First-time connect bonus (only once)
        if (!localStorage.getItem('lockgram_first_connect')) {
          addCoins(50);
          localStorage.setItem('lockgram_first_connect', 'true');
        }
      } else {
        addrEl.textContent = '';
        statusEl.textContent = 'Wallet not connected';
      }
    });

    // Add coins + save + haptic
    function addCoins(amount) {
      userBalance += amount;
      document.getElementById('balance').textContent = userBalance;
      localStorage.setItem('lockgram
